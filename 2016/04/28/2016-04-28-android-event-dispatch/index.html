<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="150x150" href="/images/favicon-150x150-next.png">
  <link rel="icon" type="image/png" sizes="150x150" href="/images/favicon-150x150-next.png">
  <link rel="icon" type="image/png" sizes="150x150" href="/images/favicon-150x150-next.png">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|EB Garamond:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lwenkun.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"order":-2}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="安卓事件传递机制的理解事件产生的源头以及预处理当我们的手指点击（滑动）屏幕时，我们的手指就可能触发了一系列的事件，这些事件队列的排列顺序可以这样表示：{ ACTION_DOWN, ACTION_MOVE, ACTION_MOVE, ACTION_MOVE, … , ACTION_UP }，这样表示最开始我们触发的事件是ACTION_DOWN，然后是一至多个ACTION_MOVE事件（其实点击时也会">
<meta property="og:type" content="article">
<meta property="og:title" content="安卓事件传递机制的理解">
<meta property="og:url" content="https://lwenkun.github.io/2016/04/28/2016-04-28-android-event-dispatch/index.html">
<meta property="og:site_name" content="李文坤的博客">
<meta property="og:description" content="安卓事件传递机制的理解事件产生的源头以及预处理当我们的手指点击（滑动）屏幕时，我们的手指就可能触发了一系列的事件，这些事件队列的排列顺序可以这样表示：{ ACTION_DOWN, ACTION_MOVE, ACTION_MOVE, ACTION_MOVE, … , ACTION_UP }，这样表示最开始我们触发的事件是ACTION_DOWN，然后是一至多个ACTION_MOVE事件（其实点击时也会">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-04-28T00:00:00.000Z">
<meta property="article:modified_time" content="2024-09-19T06:21:15.014Z">
<meta property="article:author" content="Chance Li">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="View">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://lwenkun.github.io/2016/04/28/2016-04-28-android-event-dispatch/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>安卓事件传递机制的理解 | 李文坤的博客</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-76493784-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-76493784-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4cc1f2d8f3067386cc5cdb626a202900";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">李文坤的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">吾生也有涯</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">26</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">27</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lwenkun.github.io/2016/04/28/2016-04-28-android-event-dispatch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://www.gravatar.com/avatar/95a0f14d3e6b40995a92c41673fd09d4?s=640">
      <meta itemprop="name" content="Chance Li">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李文坤的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          安卓事件传递机制的理解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-04-28 00:00:00" itemprop="dateCreated datePublished" datetime="2016-04-28T00:00:00+00:00">2016-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-19 06:21:15" itemprop="dateModified" datetime="2024-09-19T06:21:15+00:00">2024-09-19</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="安卓事件传递机制的理解"><a href="#安卓事件传递机制的理解" class="headerlink" title="安卓事件传递机制的理解"></a>安卓事件传递机制的理解</h1><h2 id="事件产生的源头以及预处理"><a href="#事件产生的源头以及预处理" class="headerlink" title="事件产生的源头以及预处理"></a>事件产生的源头以及预处理</h2><p>当我们的手指点击（滑动）屏幕时，我们的手指就可能触发了一系列的事件，这些事件队列的排列顺序可以这样表示：{ <code>ACTION_DOWN</code>, <code>ACTION_MOVE</code>, <code>ACTION_MOVE</code>, <code>ACTION_MOVE</code>, … , <code>ACTION_UP</code> }，这样表示最开始我们触发的事件是<code>ACTION_DOWN</code>，然后是一至多个<code>ACTION_MOVE</code>事件（其实点击时也会触发<code>ACTION_MOVE</code>事件，因为屏幕很灵敏），当手指离开屏幕的瞬间，触发了一个 <code>ACTION_UP</code> 事件。</p>
<p>事件既然产生了，那怎么传递呢？</p>
<span id="more"></span>

<p>先别急，事件产生了，但还没获取呢。首先，消息获取模块会将事件通过pipe管道传递到客户端，然后 <code>InputQueue</code> 中的 <code>next()</code> 函数内部调用 <code>nativePollOnce()</code> 函数，该函数仅仅是一个 <code>DISPATCH_POINTER</code> 的异步消息，消息处理函数是 <code>deliverPointerEvent()</code> 函数。执行完该函数后，调用 <code>finishInputEvent()</code> 向消息获取模块发送一个回执，以使其进行下一个消息派送，真正完成绘制的代码是 native C++ 写的。</p>
<p>在 <code>deliverPointerEvent()</code> 中，会进行一些转换，包括物理像素到逻辑像素的转换和屏幕坐标到视图坐标的转换，这都是为消息的派发做好准备。</p>
<h2 id="事件的传递"><a href="#事件的传递" class="headerlink" title="事件的传递"></a>事件的传递</h2><p>执行了转换后，我们的事件即event便开始了漫长的旅途。</p>
<p>如果用一句话来概括event的漫长路途的话便是：</p>
<p><strong><code>deliverPointerEvent()</code> 通过执行 <code>mView.dispatchTouchEvent()</code> 将消息派发给根视图（这个根视图具体是谁我们等下在后面会提到），之后mView便会将事件派发到整个 <code>View</code> 树。</strong></p>
<p>太抽象笼统了是吧？那我们便来细细分析，你可以泡上一杯茶或咖啡，跟随 event 看看他在漫长旅途中发生的了那些有趣的事。</p>
<h3 id="事件在进入View树之前的传递"><a href="#事件在进入View树之前的传递" class="headerlink" title="事件在进入View树之前的传递"></a>事件在进入View树之前的传递</h3><p>前面说了 event 的第一站便是 <code>mView.dispatchTouchEvent()</code>，该函数是在<code>ViewRoot</code>（注意 <code>ViewRoot</code> 不是 <code>View</code> 类，而是继承 <code>Handle</code> 类，用于对整个视图数的控制）中调用的，<code>mView</code> 有两种类型，对于应用窗口来说，<code>mView</code> 是一个 <code>PhoneWindow</code> 的 <code>DecorView</code> 类型，对于非应用窗口而言，<code>mView</code> 是一般的 <code>ViewGroup</code> 类型。</p>
<p>在 <code>DecorView</code> 中，会判断是否存在 <code>Callback</code> 对象，这个 <code>Callback</code> 对象是谁呢？哈哈，竟然是 <code>Activity</code>，其实不奇怪，我们看源码就可以知道 <code>Activity</code> 实现了 <code>Window.Callback</code> 这个回调接口。如果不存在 <code>Callback</code> 对象的话，那么就直接调用 <code>DecorView</code> 父类 <code>ViewGroup</code> 中的 <code>dispatchTouchEvent()</code> 方法。</p>
<p>我们首先看如果存在 <code>Callback</code> 对象即 <code>Activity</code> 时，event是在 <code>Activity</code> 中经历了什么。</p>
<p>在 <code>Activity</code> 中，event 被传入了它的 <code>dispatchTouchEvent()</code> 方法：<br>如果 event 的消息类型是 <code>ACTION_DOWN</code>，那么就调用 <code>onUserInteraction()</code>，这个方法是个空方法，什么也不干，只是让应用程序一个处理消息的机会，应用如果想在消息传递的最初始阶段想做些什么的话，就可以在这个函数中实现；<br>然后这个方法中又会调用 <code>Activity</code> 关联的 <code>Window</code> 类对象的 <code>superDispatchTouchEvent()</code> 方法；<br>如果 <code>Window</code> 类没有消耗该消息，那么 <code>Activity</code> 就会调用自己的 <code>onTouchEvent()</code> 方法，该方法也默认什么都不做，留给应用程序实现。</p>
<p><code>Window</code> 类中在event身上又发生了什么呢，我们往下看：</p>
<p><code>Window</code> 类的 <code>superDispatchEvent()</code> 方法中，会调用 <code>mDecor</code> 的 <code>superDispatchTouchEvent()</code> 方法，这个方法又会调用 <code>super.dispatchTouchEvent()</code>，即调用自己父类的 <code>dispatchTouchEvent()</code> 方法。看到这里我们猛然回头发现这是到了 <code>DecorView</code> 中如果不存在 <code>Callback</code> 对象时要走的另一条支路。</p>
<p>为什么要这样做呢？很明显，这是让 event 在视图树中旅行之前给 <code>Activity</code> 一个处理它的机会。很明显，这一阶段虽然 event 已经进入 <code>View</code> 树的根视图中了，但是主要还是在 <code>Activity</code> 中被处理，所以还是把这阶段归结为在 <code>Activity</code> 中的传递</p>
<p>之后开始才是 event 真正在视图树中的旅途了，它进入了视图树这个庞大的王国之中，各种有趣的事即将发生。</p>
<h3 id="事件在View树中的传递"><a href="#事件在View树中的传递" class="headerlink" title="事件在View树中的传递"></a>事件在View树中的传递</h3><p>我们知道 <code>DecorView</code> 是一个 <code>ViewGroup</code>，所以我们从 <code>ViewGroup</code> 分析。</p>
<p>event 进入 <code>ViewGroup</code> 后，<code>ViewGroup</code> 便通过 <code>dispatchTouchEvent()</code> 方法将它派送，它先会被派送到 <code>onInterceptTouchEvent()</code> 中（决定是否将其拦截），这个方法的意思是拦截，在 <code>ViewGroup</code> 中，它的默认实现是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onInterceptTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;</span><br><span class="line">   retrun <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是不拦截意思。</p>
<p>关于这个方法官方文档有段很长的话（本来想翻译的，但是想想怕翻译得不好坏了原本的意思），大家还是自己翻译看看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Implement this method to intercept all touch screen motion events.  This </span></span><br><span class="line"><span class="comment"> * allows you to watch events as they are dispatched to your children, and </span></span><br><span class="line"><span class="comment"> * take ownership of the current gesture at any point. </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Using this function takes some care, as it has a fairly complicated </span></span><br><span class="line"><span class="comment"> * interaction with &#123;<span class="doctag">@link</span> View#onTouchEvent(MotionEvent) </span></span><br><span class="line"><span class="comment"> * View.onTouchEvent(MotionEvent)&#125;, and using it requires implementing </span></span><br><span class="line"><span class="comment"> * that method as well as this one in the correct way.  Events will be </span></span><br><span class="line"><span class="comment"> * received in the following order: </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;ol&gt; </span></span><br><span class="line"><span class="comment"> * &lt;li&gt; You will receive the down event here. </span></span><br><span class="line"><span class="comment"> * &lt;li&gt; The down event will be handled either by a child of this view </span></span><br><span class="line"><span class="comment"> * group, or given to your own onTouchEvent() method to handle; this means </span></span><br><span class="line"><span class="comment"> * you should implement onTouchEvent() to return true, so you will </span></span><br><span class="line"><span class="comment"> * continue to see the rest of the gesture (instead of looking for </span></span><br><span class="line"><span class="comment"> * a parent view to handle it).  Also, by returning true from </span></span><br><span class="line"><span class="comment"> * onTouchEvent(), you will not receive any following </span></span><br><span class="line"><span class="comment"> * events in onInterceptTouchEvent() and all touch processing must </span></span><br><span class="line"><span class="comment"> * happen in onTouchEvent() like normal. </span></span><br><span class="line"><span class="comment"> * &lt;li&gt; For as long as you return false from this function, each following </span></span><br><span class="line"><span class="comment"> * event (up to and including the final up) will be delivered first here </span></span><br><span class="line"><span class="comment"> * and then to the target&#x27;s onTouchEvent(). </span></span><br><span class="line"><span class="comment"> * &lt;li&gt; If you return true from here, you will not receive any </span></span><br><span class="line"><span class="comment"> * following events: the target view will receive the same event but </span></span><br><span class="line"><span class="comment"> * with the action &#123;<span class="doctag">@link</span> MotionEvent#ACTION_CANCEL&#125;, and all further </span></span><br><span class="line"><span class="comment"> * events will be delivered to your onTouchEvent() method and no longer </span></span><br><span class="line"><span class="comment"> * appear here. </span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ev The motion event being dispatched down the hierarchy. </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Return true to steal motion events from the children and have </span></span><br><span class="line"><span class="comment"> * them dispatched to this ViewGroup through onTouchEvent(). </span></span><br><span class="line"><span class="comment"> * The current target will receive an ACTION_CANCEL event, and no further </span></span><br><span class="line"><span class="comment"> * messages will be delivered here. </span></span><br><span class="line"><span class="comment"> */</span>  </span><br></pre></td></tr></table></figure>

<p>而 <code>ViewGroup</code> 中的 <code>dispatchTouchEvent()</code> 的源码是这样的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> ev.getAction();  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">xf</span> <span class="operator">=</span> ev.getX();  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">yf</span> <span class="operator">=</span> ev.getY();  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">scrolledXFloat</span> <span class="operator">=</span> xf + mScrollX;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">scrolledYFloat</span> <span class="operator">=</span> yf + mScrollY;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">Rect</span> <span class="variable">frame</span> <span class="operator">=</span> mTempRect;  </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">disallowIntercept</span> <span class="operator">=</span> (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (action == MotionEvent.ACTION_DOWN) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (mMotionTarget != <span class="literal">null</span>) &#123;  </span><br><span class="line">            mMotionTarget = <span class="literal">null</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (disallowIntercept || !onInterceptTouchEvent(ev)) &#123;  </span><br><span class="line">            ev.setAction(MotionEvent.ACTION_DOWN);  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">scrolledXInt</span> <span class="operator">=</span> (<span class="type">int</span>) scrolledXFloat;  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">scrolledYInt</span> <span class="operator">=</span> (<span class="type">int</span>) scrolledYFloat;  </span><br><span class="line">            <span class="keyword">final</span> View[] children = mChildren;  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> mChildrenCount;  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> count - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;  </span><br><span class="line">                <span class="keyword">final</span> <span class="type">View</span> <span class="variable">child</span> <span class="operator">=</span> children[i];  </span><br><span class="line">                <span class="keyword">if</span> ((child.mViewFlags &amp; VISIBILITY_MASK) == VISIBLE  </span><br><span class="line">                        || child.getAnimation() != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    child.getHitRect(frame);  </span><br><span class="line">                    <span class="keyword">if</span> (frame.contains(scrolledXInt, scrolledYInt)) &#123;  </span><br><span class="line">                        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">xc</span> <span class="operator">=</span> scrolledXFloat - child.mLeft;  </span><br><span class="line">                        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">yc</span> <span class="operator">=</span> scrolledYFloat - child.mTop;  </span><br><span class="line">                        ev.setLocation(xc, yc);  </span><br><span class="line">                        child.mPrivateFlags &amp;= ~CANCEL_NEXT_UP_EVENT;  </span><br><span class="line">                        <span class="keyword">if</span> (child.dispatchTouchEvent(ev))  &#123;  </span><br><span class="line">                            mMotionTarget = child;  </span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isUpOrCancel</span> <span class="operator">=</span> (action == MotionEvent.ACTION_UP) ||  </span><br><span class="line">            (action == MotionEvent.ACTION_CANCEL);  </span><br><span class="line">    <span class="keyword">if</span> (isUpOrCancel) &#123;  </span><br><span class="line">        mGroupFlags &amp;= ~FLAG_DISALLOW_INTERCEPT;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">View</span> <span class="variable">target</span> <span class="operator">=</span> mMotionTarget;  </span><br><span class="line">    <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;  </span><br><span class="line">        ev.setLocation(xf, yf);  </span><br><span class="line">        <span class="keyword">if</span> ((mPrivateFlags &amp; CANCEL_NEXT_UP_EVENT) != <span class="number">0</span>) &#123;  </span><br><span class="line">            ev.setAction(MotionEvent.ACTION_CANCEL);  </span><br><span class="line">            mPrivateFlags &amp;= ~CANCEL_NEXT_UP_EVENT;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.dispatchTouchEvent(ev);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (!disallowIntercept &amp;&amp; onInterceptTouchEvent(ev)) &#123;  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">xc</span> <span class="operator">=</span> scrolledXFloat - (<span class="type">float</span>) target.mLeft;  </span><br><span class="line">        <span class="keyword">final</span> <span class="type">float</span> <span class="variable">yc</span> <span class="operator">=</span> scrolledYFloat - (<span class="type">float</span>) target.mTop;  </span><br><span class="line">        mPrivateFlags &amp;= ~CANCEL_NEXT_UP_EVENT;  </span><br><span class="line">        ev.setAction(MotionEvent.ACTION_CANCEL);  </span><br><span class="line">        ev.setLocation(xc, yc);  </span><br><span class="line">        <span class="keyword">if</span> (!target.dispatchTouchEvent(ev)) &#123;  </span><br><span class="line">        &#125;  </span><br><span class="line">        mMotionTarget = <span class="literal">null</span>;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (isUpOrCancel) &#123;  </span><br><span class="line">        mMotionTarget = <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">xc</span> <span class="operator">=</span> scrolledXFloat - (<span class="type">float</span>) target.mLeft;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">float</span> <span class="variable">yc</span> <span class="operator">=</span> scrolledYFloat - (<span class="type">float</span>) target.mTop;  </span><br><span class="line">    ev.setLocation(xc, yc);  </span><br><span class="line">    <span class="keyword">if</span> ((target.mPrivateFlags &amp; CANCEL_NEXT_UP_EVENT) != <span class="number">0</span>) &#123;  </span><br><span class="line">        ev.setAction(MotionEvent.ACTION_CANCEL);  </span><br><span class="line">        target.mPrivateFlags &amp;= ~CANCEL_NEXT_UP_EVENT;  </span><br><span class="line">        mMotionTarget = <span class="literal">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> target.dispatchTouchEvent(ev);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>结合官方文档和源码我解释一下：</p>
<p><strong>1.</strong> 如果 <code>disallowIntercept</code> 为 <code>false</code> （默认是 <code>false</code>，子视图通过 <code>requestDisallowInterceptTouchEvent(true)</code> 可不允许父视图拦截消息），并且 <code>onInterceptTouchEvent()</code> 返回 <code>true</code>，那么 <code>ViewGroup</code> 就会拦截事件，事件不会给子视图处理，而是交由自己父类的 <code>dispatchTouchEvent()</code> 来处理，即 <code>View</code> 的 <code>diapatchTouchEvent()</code> 来处理，这也就相当与ViewGroup将事件交给了自己来处理。<code>View</code> 的 <code>dispatchTouchEvent()</code> 长什么样呢？我们看看源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> (mOnTouchListener != <span class="literal">null</span> &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp;  </span><br><span class="line">            mOnTouchListener.onTouch(<span class="built_in">this</span>, event)) &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> onTouchEvent(event);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>安卓5.0之后该方法的实现略带复杂，但是基本思想还是一样的，我们不妨就拿这个简单的来分析。在这个方法中会判断这个 <code>View</code> 的 <code>OnTouchListener</code> 回调接口是否存在，<code>View</code> 是不是 <code>ENABLE</code> 状态，是的话就会继续执行到第三个条件，第三个条件其实执行了 <code>OnTouchListener</code> 的 <code>onTouch()</code> 方法，这个方法是我们调用 <code>view.setOnTouchListener()</code> 时实现的。如果这个方法返回了 true， 那么 <code>dispatchEvent()</code> 方法也返回 <code>true</code>，<code>dispatchEvent()</code> 方法执行完毕；如果回调接口不存在，或者这个 <code>View</code> 是 <code>DISABLE</code> 状态，或者 <code>onTouch()</code> 返回 <code>false</code>（即 <code>onTouch()</code> 未消耗该 event）时， 便会执行 <code>onTouchEvent()</code> 方法。如果 <code>onTouchEvent()</code> 返回 <code>false</code> （即这个方法也未消耗 event)时，<code>dispatchTouchEvent()</code> 返回 <code>false</code>，从而表明 <code>View</code> 未消耗这个事件；反之 <code>onTouchEvent()</code> 返回 <code>true</code> 即消耗了这个事件时，<code>dispatchTouchEvent()</code> 也返回 <code>true</code>，表明 <code>View</code> 消耗了该事件。</p>
<p>从上面的分析，我们可以看出，一个 event 在 <code>View</code> 中，首先会被 <code>dispatchTouchEvent()</code> 派发给 <code>onTouch()</code> 处理（前提是注册了 <code>onTouch()</code> 事件），如果 <code>onTouch()</code> 返回 <code>true</code>（消耗了该 event），event 在 <code>View</code> 中的旅程就结束了，<code>dispatchTouchEvent()</code>返回 <code>true</code>；如果没消耗就会继续派发给  <code>onTouchEvent()</code> 来处理，<code>dispatchTouchEvent()</code> 会将 <code>onTouchEvent()</code> 的返回值作为自己的返回值。</p>
<p>接下来我们自然想知道，event 在 <code>onTouchEvent()</code> 方法中会发生什么呢，我们看看源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(MotionEvent event)</span> &#123;  </span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">viewFlags</span> <span class="operator">=</span> mViewFlags;  </span><br><span class="line">    <span class="keyword">if</span> ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;  </span><br><span class="line">        <span class="comment">// A disabled view that is clickable still consumes the touch  </span></span><br><span class="line">        <span class="comment">// events, it just doesn&#x27;t respond to them.  </span></span><br><span class="line">        <span class="keyword">return</span> (((viewFlags &amp; CLICKABLE) == CLICKABLE ||  </span><br><span class="line">                (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE));  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (mTouchDelegate != <span class="literal">null</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (mTouchDelegate.onTouchEvent(event)) &#123;  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">if</span> (((viewFlags &amp; CLICKABLE) == CLICKABLE ||  </span><br><span class="line">            (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)) &#123;  </span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:  </span><br><span class="line">                <span class="type">boolean</span> <span class="variable">prepressed</span> <span class="operator">=</span> (mPrivateFlags &amp; PREPRESSED) != <span class="number">0</span>;  </span><br><span class="line">                <span class="keyword">if</span> ((mPrivateFlags &amp; PRESSED) != <span class="number">0</span> || prepressed) &#123;  </span><br><span class="line">                    <span class="comment">// take focus if we don&#x27;t have it already and we should in  </span></span><br><span class="line">                    <span class="comment">// touch mode.  </span></span><br><span class="line">                    <span class="type">boolean</span> <span class="variable">focusTaken</span> <span class="operator">=</span> <span class="literal">false</span>;  </span><br><span class="line">                    <span class="keyword">if</span> (isFocusable() &amp;&amp; isFocusableInTouchMode() &amp;&amp; !isFocused()) &#123;  </span><br><span class="line">                        focusTaken = requestFocus();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">if</span> (!mHasPerformedLongPress) &#123;  </span><br><span class="line">                        <span class="comment">// This is a tap, so remove the longpress check  </span></span><br><span class="line">                        removeLongPressCallback();  </span><br><span class="line">                        <span class="comment">// Only perform take click actions if we were in the pressed state  </span></span><br><span class="line">                        <span class="keyword">if</span> (!focusTaken) &#123;  </span><br><span class="line">                            <span class="comment">// Use a Runnable and post this rather than calling  </span></span><br><span class="line">                            <span class="comment">// performClick directly. This lets other visual  </span></span><br><span class="line">                            <span class="comment">// state of the view update before click actions start.  </span></span><br><span class="line">                            <span class="keyword">if</span> (mPerformClick == <span class="literal">null</span>) &#123;  </span><br><span class="line">                                mPerformClick = <span class="keyword">new</span> <span class="title class_">PerformClick</span>();  </span><br><span class="line">                            &#125;  </span><br><span class="line">                            <span class="keyword">if</span> (!post(mPerformClick)) &#123;  </span><br><span class="line">                                performClick();  </span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">if</span> (mUnsetPressedState == <span class="literal">null</span>) &#123;  </span><br><span class="line">                        mUnsetPressedState = <span class="keyword">new</span> <span class="title class_">UnsetPressedState</span>();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    <span class="keyword">if</span> (prepressed) &#123;  </span><br><span class="line">                        mPrivateFlags |= PRESSED;  </span><br><span class="line">                        refreshDrawableState();  </span><br><span class="line">                        postDelayed(mUnsetPressedState,  </span><br><span class="line">                                ViewConfiguration.getPressedStateDuration());  </span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!post(mUnsetPressedState)) &#123;  </span><br><span class="line">                        <span class="comment">// If the post failed, unpress right now  </span></span><br><span class="line">                        mUnsetPressedState.run();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    removeTapCallback();  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:  </span><br><span class="line">                <span class="keyword">if</span> (mPendingCheckForTap == <span class="literal">null</span>) &#123;  </span><br><span class="line">                    mPendingCheckForTap = <span class="keyword">new</span> <span class="title class_">CheckForTap</span>();  </span><br><span class="line">                &#125;  </span><br><span class="line">                mPrivateFlags |= PREPRESSED;  </span><br><span class="line">                mHasPerformedLongPress = <span class="literal">false</span>;  </span><br><span class="line">                postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:  </span><br><span class="line">                mPrivateFlags &amp;= ~PRESSED;  </span><br><span class="line">                refreshDrawableState();  </span><br><span class="line">                removeTapCallback();  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:  </span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> (<span class="type">int</span>) event.getX();  </span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> (<span class="type">int</span>) event.getY();  </span><br><span class="line">                <span class="comment">// Be lenient about moving outside of buttons  </span></span><br><span class="line">                <span class="type">int</span> <span class="variable">slop</span> <span class="operator">=</span> mTouchSlop;  </span><br><span class="line">                <span class="keyword">if</span> ((x &lt; <span class="number">0</span> - slop) || (x &gt;= getWidth() + slop) ||  </span><br><span class="line">                        (y &lt; <span class="number">0</span> - slop) || (y &gt;= getHeight() + slop)) &#123;  </span><br><span class="line">                    <span class="comment">// Outside button  </span></span><br><span class="line">                    removeTapCallback();  </span><br><span class="line">                    <span class="keyword">if</span> ((mPrivateFlags &amp; PRESSED) != <span class="number">0</span>) &#123;  </span><br><span class="line">                        <span class="comment">// Remove any future long press/tap checks  </span></span><br><span class="line">                        removeLongPressCallback();  </span><br><span class="line">                        <span class="comment">// Need to switch from pressed to not pressed  </span></span><br><span class="line">                        mPrivateFlags &amp;= ~PRESSED;  </span><br><span class="line">                        refreshDrawableState();  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>在 <code>onTouchEvent()</code> 方法中我们看到，如果这个 <code>View</code> 是可点击的，那么对于 <code>ACTOIN_UP</code> 事件，我们就发送一个异步消息来处理点击事件，如果异步消息没有发送成功，那么就会立即执行点击事件，在源码中也就是 <code>performClick()</code> 方法，<code>performClick()</code> 方法是怎样的呢，如果你看了源码就知道则个方法里执行的是我们 <code>View</code> 注册点击事件，即 <code>OnClickListener的onClick()</code> 方法。当然 <code>ACTOIN_UP</code> 有还有可能会触发长按事件 <code>onLongClick()</code>，这里就不详细介绍了。</p>
<p><strong>2.</strong> 如果 <code>disallowIntercept</code> 为 <code>false</code> 并且 <code>ViewGroup</code> 没有拦截 event（即返回 <code>false</code> ），或者 <code>disallowIntercept</code> 为 <code>true</code>，那么事件就会传给 <code>ViewGroup</code> 中被点击的那个子视图（这里包括前面所讲的子&#x2F;父视图都包括 <code>View</code> 和 <code>ViewGroup</code>），这样就回到了事件在 <code>View</code> 或者 <code>ViewGroup</code> 的传递过程了，我们就可以按照前面的分析用递归思想理解后续的过程。</p>
<p>需要注意的是，在 <code>ViewGroup</code> 的 <code>dispatchTouchEvent()</code> 方法中，我们能够知道，如果当事件  <code>ACTION_DOWN</code> 没有找到目标子视图（可能原因是没有点击到任何子视图或者虽然有子视图被点击但是该子视图没有消耗该事件，即子视图的 <code>dispatchTouchEvent()</code> 方法返回 <code>false</code>）时，<code>ViewGroup</code> 会将事件交给自己处理，并且之后的 <code>ACTION_MOVE</code> 和 <code>ACTION_UP</code> 事件都不会交给任何子视图处理，也是全交给自己处理，也即前面讲的交给 <code>super.dispatchTouchEvent()</code> 来处理。</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p><strong>1. 一个视图是否消耗该事件，表现在 <code>dispatchTouchEvent()</code> 的返回值上，如返回 <code>true</code> 表示消耗 <code>false</code> 表示未消耗；而一个消息处理方法（指的是 <code>ouTouch()</code> 和 <code>onEventTouch()</code>，不包括  <code>onInterceptTouchEvent()</code>)是否消耗该事件表现在该方法的返回值上，例如 <code>onTouch()</code> 方法返回 <code>true</code> 表示消耗 <code>false</code> 表示未消耗。</strong></p>
<p><strong>2. 如果某个视图的某个消息处理方法消耗该事件，会使得该视图的 <code>dispatchTouchEvent()</code> 方法返回 <code>true</code>，即该视图消耗了该事件；如果某个视图的所有消息处理方法都返回 <code>false</code>，那么这个视图的 <code>dispatchTouchEvent()</code> 方法返回 <code>false</code>，即该视图没有消耗该事件。</strong></p>
<p>到了这里安卓事件的传递就应该结束了，但我在这之中省略了对 <code>ViewGroup</code> 是如何找到被点击的子视图的的分析，这个我会在之后分享。以上便是我对安卓 <code>View</code> 的事件传递机制的理解，有什么疏漏或者错误的地方欢迎大家指出。</p>
<p>参考文章：<br/><br><a target="_blank" rel="noopener" href="http://blog.csdn.net/guolin_blog/article/details/9097463" title="郭霖的博客">http://blog.csdn.net/guolin_blog&#x2F;article&#x2F;details&#x2F;9097463</a>、<a target="_blank" rel="noopener" href="http://blog.csdn.net/guolin_blog/article/details/9153761" title="郭霖的博客">http://blog.csdn.net/guolin_blog&#x2F;article&#x2F;details&#x2F;9153761</a></p>
<p>参考书籍：《Android 内核剖析》柯元旦 著</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>chance
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://lwenkun.github.io/2016/04/28/2016-04-28-android-event-dispatch/" title="安卓事件传递机制的理解">https://lwenkun.github.io/2016/04/28/2016-04-28-android-event-dispatch/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
              <a href="/tags/View/" rel="tag"><i class="fa fa-tag"></i> View</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2016/04/16/2016-04-16-android-viewpager-usage/" rel="prev" title="ViewPager 的使用">
      <i class="fa fa-chevron-left"></i> ViewPager 的使用
    </a></div>
      <div class="post-nav-item">
    <a href="/2016/05/03/2016-05-03-java-hashcode-and-equals/" rel="next" title="浅析 hashcode() 和 equals()">
      浅析 hashcode() 和 equals() <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <script src="https://utteranc.es/client.js"                                     repo="Lwenkun/lwenkun.github.io"                                     issue-term="pathname"                                     theme="github-dark"                                     crossorigin="anonymous"                                     async>                                 </script>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E5%8D%93%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6%E7%9A%84%E7%90%86%E8%A7%A3"><span class="nav-number">1.</span> <span class="nav-text">安卓事件传递机制的理解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E4%BA%A7%E7%94%9F%E7%9A%84%E6%BA%90%E5%A4%B4%E4%BB%A5%E5%8F%8A%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-number">1.1.</span> <span class="nav-text">事件产生的源头以及预处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92"><span class="nav-number">1.2.</span> <span class="nav-text">事件的传递</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%9C%A8%E8%BF%9B%E5%85%A5View%E6%A0%91%E4%B9%8B%E5%89%8D%E7%9A%84%E4%BC%A0%E9%80%92"><span class="nav-number">1.2.1.</span> <span class="nav-text">事件在进入View树之前的传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%9C%A8View%E6%A0%91%E4%B8%AD%E7%9A%84%E4%BC%A0%E9%80%92"><span class="nav-number">1.2.2.</span> <span class="nav-text">事件在View树中的传递</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">1.3.</span> <span class="nav-text">说明</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chance Li"
      src="https://www.gravatar.com/avatar/95a0f14d3e6b40995a92c41673fd09d4?s=640">
  <p class="site-author-name" itemprop="name">Chance Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Lwenkun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Lwenkun" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lwenkun666@gmail.com" title="E-Mail → mailto:lwenkun666@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/5261683001" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;5261683001" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> 微博</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/li-wen-kun-40" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;li-wen-kun-40" rel="noopener" target="_blank"><i class="fa fa-fw fa-globe"></i> 知乎</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://ylqhust.github.io/" title="http:&#x2F;&#x2F;ylqhust.github.io" rel="noopener" target="_blank">ylqhust的博客</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chance Li</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">245k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:43</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
